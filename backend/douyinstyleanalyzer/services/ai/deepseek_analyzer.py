"""
DeepSeek å¤§æ¨¡å‹åˆ†ææœåŠ¡
ç”¨äºåˆ†æåšä¸»é£æ ¼å’Œå†…å®¹ç‰¹ç‚¹
"""

import json
import requests
import time
from datetime import datetime
from typing import Dict, List, Optional
from ...config import Config


class DeepSeekAnalyzer:
    """DeepSeek å¤§æ¨¡å‹åˆ†æå™¨"""
    
    def __init__(self):
        self.config = Config()
        self.api_key = getattr(self.config, 'DEEPSEEK_API_KEY', '')
        self.base_url = "https://api.deepseek.com/v1/chat/completions"
        self.model = "deepseek-chat"
        
    def analyze_blogger_style(self, blogger_name: str, videos_data: List[Dict]) -> Dict:
        """
        åˆ†æåšä¸»é£æ ¼
        
        Args:
            blogger_name: åšä¸»åå­—
            videos_data: è§†é¢‘æ•°æ®åˆ—è¡¨ï¼ŒåŒ…å«æ ‡é¢˜å’Œè½¬å½•æ–‡æœ¬
            
        Returns:
            åˆ†æç»“æœå­—å…¸
        """
        try:
            print(f"ğŸ¤– å¼€å§‹ä½¿ç”¨DeepSeekåˆ†æåšä¸» {blogger_name} çš„é£æ ¼...")
            
            # å‡†å¤‡åˆ†ææ•°æ®
            analysis_data = self._prepare_analysis_data(blogger_name, videos_data)
            
            # æ„å»ºåˆ†ææç¤ºè¯
            prompt = self._build_analysis_prompt(analysis_data)
            
            # è°ƒç”¨DeepSeek API
            response = self._call_deepseek_api(prompt)
            
            if response:
                # è§£æå“åº”
                analysis_result = self._parse_analysis_response(response)
                print(f"âœ… DeepSeekåˆ†æå®Œæˆ")
                return analysis_result
            else:
                print(f"âŒ DeepSeekåˆ†æå¤±è´¥")
                return self._get_default_analysis_result(blogger_name)
                
        except Exception as e:
            print(f"âŒ DeepSeekåˆ†æå‡ºé”™: {e}")
            return self._get_default_analysis_result(blogger_name)
    
    def _prepare_analysis_data(self, blogger_name: str, videos_data: List[Dict]) -> Dict:
        """å‡†å¤‡åˆ†ææ•°æ®"""
        # æå–è§†é¢‘æ ‡é¢˜å’Œè½¬å½•æ–‡æœ¬
        titles = []
        transcripts = []
        
        for video in videos_data:
            if video.get('title'):
                titles.append(video['title'])
            if video.get('transcript'):
                transcripts.append(video['transcript'])
        
        return {
            'blogger_name': blogger_name,
            'total_videos': len(videos_data),
            'titles': titles,
            'transcripts': transcripts,
            'sample_titles': titles[:10],  # å–å‰10ä¸ªæ ‡é¢˜ä½œä¸ºæ ·æœ¬
            'sample_transcripts': transcripts[:5]  # å–å‰5ä¸ªè½¬å½•æ–‡æœ¬ä½œä¸ºæ ·æœ¬
        }
    
    def _build_analysis_prompt(self, data: Dict) -> str:
        """æ„å»ºåˆ†ææç¤ºè¯"""
        prompt = f"""
### **ã€ç«å“é£æ ¼ä¸ç­–ç•¥æ·±åº¦è§£æ„ã€‘é«˜çº§æç¤ºè¯**

**ä¸€ã€æ ¸å¿ƒæŒ‡ä»¤ï¼š**
è¯·ä½ æ‰®æ¼”ä¸€ä½èµ„æ·±å•†ä¸šç­–ç•¥åˆ†æå¸ˆä¸æ¶ˆè´¹å¿ƒç†å­¦ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¯¹æä¾›çš„æ–‡æœ¬å†…å®¹è¿›è¡Œä¸€åœºæè‡´æ·±å…¥çš„è§£æ„åˆ†æï¼Œæœ€ç»ˆäº§å‡ºä¸€ä»½å¯ç”¨äº**æ·±åº¦æ¨¡ä»¿ä¸æˆ˜ç•¥è¶…è¶Š**çš„ç«å“åˆ†ææŠ¥å‘Šã€‚æŠ¥å‘Šéœ€è¶…è¶Šç®€å•çš„é£æ ¼å½’çº³ï¼Œå¿…é¡»æ­ç¤ºå…¶åº•å±‚çš„**å†…å®¹æ¶æ„ã€å¿ƒç†æ“çºµæœºåˆ¶ã€è¯­è¨€ä¿®è¾ç³»ç»ŸåŠæˆ˜ç•¥æ„å›¾**ã€‚

**äºŒã€åˆ†ææ¡†æ¶ä¸å¿…é¡»æ¶µç›–çš„ç»´åº¦ï¼š**

1.  **æˆ˜ç•¥å®šä½ä¸ä»·å€¼ä¸»å¼ æå‡ºï¼š**
    *   åˆ¤å®šå…¶åœ¨è¯¥å†…å®¹ç”Ÿæ€ä¸­çš„ç‹¬ç‰¹è§’è‰²ï¼ˆä¾‹å¦‚ï¼š"åå›è€…"ã€"å¸ƒé“è€…"ã€"è¿æ¥è€…"ï¼‰ã€‚
    *   ç²¾å‡†æ¦‚æ‹¬å…¶å‘ç›®æ ‡ç”¨æˆ·ä¼ é€’çš„æ ¸å¿ƒä»·å€¼ä¸»å¼ ã€‚åˆ†æå…¶å¦‚ä½•åŒæ—¶æ»¡è¶³ç”¨æˆ·çš„"åŠŸèƒ½éœ€æ±‚"ï¼ˆå¦‚ï¼šå­¦ä¼šå†™æ–‡æ¡ˆï¼‰å’Œ"æƒ…æ„Ÿéœ€æ±‚"ï¼ˆå¦‚ï¼šè·å¾—è®¤çŸ¥ä¼˜è¶Šæ„Ÿï¼‰ã€‚

2.  **å†…å®¹æ¶æ„çš„"å…¬å¼åŒ–"æ‹†è§£ï¼š**
    *   å¿…é¡»å°†å…¶å†…å®¹åˆ†è§£ä¸ºå¯å¤ç”¨çš„ç»“æ„æ€§æ¨¡å—ï¼ˆä¾‹å¦‚ï¼š"å…±æƒ…å›°å¢ƒ â†’ é”™è¯¯ç¤ºèŒƒ â†’ æ ¸å¿ƒå¿ƒæ³• â†’ ä¸‰æ¿æ–§ â†’ æ¡ˆä¾‹æ¼”ç» â†’ ä»·å€¼å‡å â†’ äº’åŠ¨å¼•å¯¼"ï¼‰ã€‚
    *   åˆ†ææ¯ä¸ªæ¨¡å—æ‰€è¿ç”¨çš„**å¿ƒç†å­¦æ•ˆåº”**ï¼ˆå¦‚ï¼šå‰æ™¯ç†è®ºã€ä¸åè°ƒç†è®ºã€JTBDç†è®ºï¼‰åŠå…¶æ—¨åœ¨å®ç°çš„**å…·ä½“ç”¨æˆ·å¿ƒæ™ºå½±å“**ï¼ˆå¦‚ï¼šå»ºç«‹ä¿¡ä»»ã€æ‘§æ¯æ—§è®¤çŸ¥ã€æä¾›ä»·å€¼æ„Ÿï¼‰ã€‚

3.  **è¯­è¨€ä¿®è¾ç³»ç»Ÿçš„ç²¾ç»†è§£å‰–ï¼š**
    *   è¶…è¶Š"ç”ŸåŠ¨æœ‰è¶£"çš„æ¦‚æ‹¬ï¼Œéœ€åˆ†ç±»æå‡ºå…¶å…·ä½“çš„ä¿®è¾æ‰‹æ³•è¯å…¸ã€‚ä¾‹å¦‚ï¼š
        *   **é¢ è¦†æ€§æ¯”å–»**ï¼šå¦‚ä½•å°†æŠ½è±¡æ¦‚å¿µå…·è±¡åŒ–ã€‚
        *   **æƒ…ç»ªå‰¯è¯**ï¼šåˆ—ä¸¾å…¶æœ€å¸¸ç”¨çš„æƒ…ç»ªå¼ºåŒ–è¯ï¼ˆå¦‚ï¼šç«Ÿç„¶ã€ç”šè‡³ã€ç°è½½çš„ï¼‰ï¼Œå¹¶åˆ†æå…¶åŠŸèƒ½ã€‚
        *   **è‡ªåˆ›è¯æ±‡**ï¼šè¯†åˆ«å¹¶åˆ†æå…¶åˆ›é€ æ–°è¯çš„ç›®çš„ï¼ˆå»ºç«‹è¯è¯­ä½“ç³»ã€å¼ºåŒ–è®°å¿†ç‚¹ï¼‰ã€‚
        *   **å¯¹è¯ä½“æ„å»º**ï¼šåˆ†æå…¶å¦‚ä½•é€šè¿‡äººç§°ä»£è¯å’Œå¥å¼è¥é€ äº²åˆ‡æ„Ÿã€‚

4.  **å…ƒç†è®ºæ”¯æ’‘åˆ†æï¼š**
    *   è¿½æº¯å…¶æ–¹æ³•è®ºèƒŒåå¯èƒ½å­˜åœ¨çš„**ç»å…¸è¥é”€ç†è®ºã€è¡Œä¸ºç»æµå­¦åŸç†æˆ–è®¤çŸ¥å¿ƒç†å­¦æ¨¡å‹**ï¼ˆå¦‚ï¼šFABæ¨¡å‹ã€JTBDã€è¶…çº§ç¬¦å·ç­‰ï¼‰ï¼Œå¹¶è§£é‡Šä»–æ˜¯å¦‚ä½•å°†å…¶"ä¿—è§£"å’Œ"è½¬åŒ–"ä¸ºå¤§ä¼—è¯­è¨€çš„ã€‚

5.  **å¯è¶…è¶Šæ€§åˆ†æä¸æˆ˜ç•¥å»ºè®®ï¼š**
    *   **æ¨¡å¼åˆ›æ–°å»ºè®®**ï¼šåŸºäºåˆ†æï¼Œæå‡ºå¦‚ä½•å¯¹å…¶å†…å®¹æ¨¡å¼è¿›è¡Œå‡çº§ï¼ˆä¾‹å¦‚ï¼šä»"æ•™æ¡ˆ"å‡çº§ä¸º"å‰§æœ¬"æˆ–"å·¥å…·"ï¼‰ã€‚
    *   **å†…å®¹æ·±åŒ–æ–¹å‘**ï¼šæŒ‡å‡ºå…¶åœ¨ç†è®ºæ·±åº¦æˆ–è¡Œä¸šå‚ç›´åº¦ä¸Šçš„æ½œåœ¨çŸ­æ¿ï¼Œå¹¶æå‡ºå¼ºåŒ–å»ºè®®ã€‚
    *   **äººè®¾å·®å¼‚åŒ–è·¯å¾„**ï¼šæ„æ€å¦‚ä½•åœ¨æ¨¡ä»¿å…¶æœ‰æ•ˆç»“æ„çš„åŒæ—¶ï¼Œé€šè¿‡æ›´æè‡´çš„"çœŸå®æ„Ÿ"ã€"ä¸“ä¸šæ·±åº¦"æˆ–"äº’åŠ¨æ¨¡å¼"å®ç°å·®å¼‚åŒ–è¶…è¶Šã€‚

**ä¸‰ã€è¾“å‡ºè¦æ±‚ï¼š**
*   **æ ¼å¼**ï¼šä»¥ç»“æ„åŒ–ã€å¸¦å±‚çº§çš„Markdownæ ¼å¼è¾“å‡ºã€‚
*   **æ·±åº¦**ï¼šæ¯ä¸€ä¸ªè®ºç‚¹éƒ½å¿…é¡»æœ‰æ¥è‡ªåŸæ–‡çš„**å…·ä½“å¼•ä¾‹**ä½œä¸ºæ”¯æ’‘ã€‚
*   **è§†è§’**ï¼šä¿æŒå®¢è§‚ã€å†·é™çš„æˆ˜ç•¥åˆ†æè§†è§’ï¼Œé¿å…å‡ºç°ä¸»è§‚å´‡æ‹œæ€§è¯­è¨€ã€‚
*   **åº”ç”¨æ€§**ï¼šæŠ¥å‘Šçš„æœ€ç»ˆè½è„šç‚¹å¿…é¡»æ˜¯"å¦‚ä½•ä¸ºå…¶æ‰€ç”¨"ï¼Œæä¾›æ¸…æ™°çš„å¯æ“ä½œç­–ç•¥ã€‚

---

**åˆ†æç›®æ ‡ï¼š**
åšä¸»åå­—ï¼š{data['blogger_name']}
åˆ†æè§†é¢‘æ•°é‡ï¼š{data['total_videos']} ä¸ª

**è§†é¢‘æ ‡é¢˜æ ·æœ¬ï¼š**
{json.dumps(data['sample_titles'], ensure_ascii=False, indent=2)}

**è½¬å½•æ–‡æœ¬æ ·æœ¬ï¼š**
{json.dumps(data['sample_transcripts'], ensure_ascii=False, indent=2)}

è¯·åŸºäºä»¥ä¸Šå†…å®¹ï¼ŒæŒ‰ç…§ä¸Šè¿°åˆ†ææ¡†æ¶è¿›è¡Œæ·±åº¦è§£æ„åˆ†æï¼Œå¹¶ä»¥Markdownæ ¼å¼è¿”å›åˆ†æç»“æœã€‚

è¦æ±‚ï¼š
1. ä½¿ç”¨æ ‡å‡†çš„Markdownè¯­æ³•
2. æ¯ä¸ªåˆ†æç»´åº¦ä½¿ç”¨äºŒçº§æ ‡é¢˜ï¼ˆ##ï¼‰
3. åˆ†ææ·±å…¥ã€ä¸“ä¸šï¼Œæ¯ä¸ªç»´åº¦éƒ½è¦æœ‰å…·ä½“çš„å¼•ä¾‹æ”¯æ’‘
4. æä¾›å¯æ“ä½œçš„æˆ˜ç•¥å»ºè®®
5. ä¿æŒç»“æ„æ¸…æ™°ï¼Œä¾¿äºé˜…è¯»

è¯·ç›´æ¥è¿”å›Markdownæ ¼å¼çš„åˆ†ææŠ¥å‘Šï¼Œä¸è¦ä½¿ç”¨JSONæ ¼å¼ã€‚
"""
        return prompt
    
    def _call_deepseek_api(self, prompt: str) -> Optional[str]:
        """è°ƒç”¨DeepSeek API"""
        if not self.api_key:
            print("âš ï¸ æœªé…ç½®DeepSeek API Keyï¼Œä½¿ç”¨æ¨¡æ‹Ÿåˆ†æ")
            return self._get_mock_response()
        
        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json"
        }
        
        data = {
            "model": self.model,
            "messages": [
                {
                    "role": "user",
                    "content": prompt
                }
            ],
            "temperature": 0.7,
            "max_tokens": 4000
        }
        
        try:
            print("ğŸ”„ æ­£åœ¨è°ƒç”¨DeepSeek API...")
            response = requests.post(self.base_url, headers=headers, json=data, timeout=60)
            
            if response.status_code == 200:
                result = response.json()
                return result['choices'][0]['message']['content']
            else:
                print(f"âŒ DeepSeek APIè°ƒç”¨å¤±è´¥: {response.status_code} - {response.text}")
                return None
                
        except Exception as e:
            print(f"âŒ DeepSeek APIè°ƒç”¨å¼‚å¸¸: {e}")
            return None
    
    def _get_mock_response(self) -> str:
        """è·å–æ¨¡æ‹Ÿå“åº”ï¼ˆç”¨äºæµ‹è¯•ï¼‰"""
        return """## æˆ˜ç•¥å®šä½ä¸ä»·å€¼ä¸»å¼ æå‡º

è¯¥åšä¸»åœ¨å†…å®¹ç”Ÿæ€ä¸­æ‰®æ¼”**"å¸ƒé“è€…"**è§’è‰²ï¼Œé€šè¿‡ä¸“ä¸šçŸ¥è¯†çš„é€šä¿—åŒ–è¡¨è¾¾ï¼Œæ»¡è¶³ç”¨æˆ·çš„åŠŸèƒ½éœ€æ±‚ï¼ˆè·å–å®ç”¨çŸ¥è¯†ï¼‰å’Œæƒ…æ„Ÿéœ€æ±‚ï¼ˆè·å¾—è®¤çŸ¥ä¼˜è¶Šæ„Ÿï¼‰ã€‚

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 
- **åŠŸèƒ½ä»·å€¼**ï¼šæä¾›å®ç”¨çš„è¥é”€çŸ¥è¯†å’Œç­–ç•¥
- **æƒ…æ„Ÿä»·å€¼**ï¼šè®©ç”¨æˆ·è·å¾—è®¤çŸ¥ä¼˜è¶Šæ„Ÿå’Œä¸“ä¸šè®¤åŒ

## å†…å®¹æ¶æ„çš„"å…¬å¼åŒ–"æ‹†è§£

å†…å®¹ç»“æ„éµå¾ª**"ç—›ç‚¹å…±é¸£â†’é”™è¯¯ç¤ºèŒƒâ†’æ ¸å¿ƒæ–¹æ³•è®ºâ†’æ¡ˆä¾‹éªŒè¯â†’ä»·å€¼å‡å"**çš„ç»å…¸æ¨¡å¼ï¼Œè¿ç”¨äº†å‰æ™¯ç†è®ºå’Œè®¤çŸ¥å¤±è°ƒç†è®ºæ¥å½±å“ç”¨æˆ·å¿ƒæ™ºã€‚

### å†…å®¹æ¨¡å—åˆ†æ
1. **ç—›ç‚¹å…±é¸£**ï¼šé€šè¿‡ç”¨æˆ·å¸¸è§é—®é¢˜å»ºç«‹è¿æ¥
2. **é”™è¯¯ç¤ºèŒƒ**ï¼šå±•ç¤ºé”™è¯¯åšæ³•ï¼Œåˆ¶é€ è®¤çŸ¥å†²çª
3. **æ ¸å¿ƒæ–¹æ³•è®º**ï¼šæä¾›è§£å†³æ–¹æ¡ˆå’Œå…·ä½“æ­¥éª¤
4. **æ¡ˆä¾‹éªŒè¯**ï¼šç”¨çœŸå®æ¡ˆä¾‹è¯æ˜æ–¹æ³•æœ‰æ•ˆæ€§
5. **ä»·å€¼å‡å**ï¼šå°†å…·ä½“æ–¹æ³•ä¸Šå‡åˆ°ç†è®ºé«˜åº¦

## è¯­è¨€ä¿®è¾ç³»ç»Ÿçš„ç²¾ç»†è§£å‰–

### ä¿®è¾æ‰‹æ³•è¯å…¸
- **é¢ è¦†æ€§æ¯”å–»**ï¼šå°†æŠ½è±¡æ¦‚å¿µå…·è±¡åŒ–ï¼Œå¦‚"è¥é”€å°±åƒè°ˆæ‹çˆ±"
- **æƒ…ç»ªå‰¯è¯**ï¼šé¢‘ç¹ä½¿ç”¨"ç«Ÿç„¶"ã€"ç”šè‡³"ã€"ç°è½½çš„"ç­‰å¼ºåŒ–è¡¨è¾¾
- **è‡ªåˆ›è¯æ±‡**ï¼šåˆ›é€ ä¸“ä¸šæœ¯è¯­å»ºç«‹è¯è¯­ä½“ç³»
- **å¯¹è¯ä½“æ„å»º**ï¼šé€šè¿‡"ä½ "ã€"æˆ‘ä»¬"ç­‰äººç§°ä»£è¯è¥é€ äº²åˆ‡æ„Ÿ

## å…ƒç†è®ºæ”¯æ’‘åˆ†æ

å…¶æ–¹æ³•è®ºèƒŒåä½“ç°äº†å¤šä¸ªç»å…¸ç†è®ºï¼š

- **FABæ¨¡å‹**ï¼ˆç‰¹æ€§-ä¼˜åŠ¿-åˆ©ç›Šï¼‰ï¼šå°†äº§å“ç‰¹æ€§è½¬åŒ–ä¸ºç”¨æˆ·åˆ©ç›Š
- **JTBDç†è®º**ï¼ˆç”¨æˆ·ä»»åŠ¡ç†è®ºï¼‰ï¼šç†è§£ç”¨æˆ·çœŸå®éœ€æ±‚
- **å‰æ™¯ç†è®º**ï¼šåˆ©ç”¨æŸå¤±åŒæ¶å¿ƒç†
- **è®¤çŸ¥å¤±è°ƒç†è®º**ï¼šé€šè¿‡å¯¹æ¯”åˆ¶é€ è®¤çŸ¥å†²çª

## å¯è¶…è¶Šæ€§åˆ†æä¸æˆ˜ç•¥å»ºè®®

### æ¨¡å¼åˆ›æ–°å»ºè®®
1. **ä»"æ•™æ¡ˆ"å‡çº§ä¸º"å‰§æœ¬"**ï¼šå¢åŠ äº’åŠ¨å…ƒç´ å’Œæ²‰æµ¸å¼ä½“éªŒ
2. **å†…å®¹æ·±åŒ–**ï¼šå¼•å…¥æ›´å¤šè¡Œä¸ºç»æµå­¦åŸç†å’Œå¿ƒç†å­¦ç†è®º
3. **äººè®¾å·®å¼‚åŒ–**ï¼šé€šè¿‡æ›´æè‡´çš„çœŸå®æ„Ÿå’Œä¸“ä¸šæ·±åº¦å®ç°è¶…è¶Š

### å…·ä½“å®æ–½ç­–ç•¥
- å¢åŠ ç”¨æˆ·å‚ä¸åº¦é«˜çš„äº’åŠ¨ç¯èŠ‚
- æä¾›æ›´æ·±å…¥çš„ç†è®ºåˆ†æå’Œæ¡ˆä¾‹ç ”ç©¶
- å»ºç«‹ç‹¬ç‰¹çš„ä¸ªäººå“ç‰Œå’Œè¯è¯­ä½“ç³»

## æ€»ä½“è¯„ä»·ä¸æ ¸å¿ƒæ´å¯Ÿ

è¿™æ˜¯ä¸€ä¸ªå…·æœ‰**æ˜ç¡®æˆ˜ç•¥æ„å›¾**çš„çŸ¥è¯†åˆ†äº«å‹åšä¸»ï¼Œå…¶å†…å®¹æ¶æ„å’Œè¯­è¨€ä¿®è¾ç³»ç»Ÿéƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå…·å¤‡å¾ˆå¼ºçš„å¯æ¨¡ä»¿æ€§å’Œè¶…è¶Šæ½œåŠ›ã€‚

### æ ¸å¿ƒä¼˜åŠ¿
- ç»“æ„åŒ–çš„å†…å®¹æ¡†æ¶
- ä¸“ä¸šåŒ–çš„ç†è®ºæ”¯æ’‘
- æƒ…æ„ŸåŒ–çš„è¡¨è¾¾æ–¹å¼
- å®ç”¨åŒ–çš„ä»·å€¼è¾“å‡º

### è¶…è¶Šæœºä¼š
é€šè¿‡æ›´æ·±å…¥çš„ç†è®ºç ”ç©¶ã€æ›´ä¸°å¯Œçš„æ¡ˆä¾‹åˆ†æã€æ›´åˆ›æ–°çš„äº’åŠ¨æ¨¡å¼ï¼Œå¯ä»¥åœ¨ä¿æŒå…¶æœ‰æ•ˆç»“æ„çš„åŸºç¡€ä¸Šå®ç°å·®å¼‚åŒ–è¶…è¶Šã€‚"""
    
    def _parse_analysis_response(self, response: str) -> Dict:
        """è§£æåˆ†æå“åº”"""
        try:
            # ç›´æ¥è¿”å›markdownå†…å®¹
            if response and response.strip():
                return {
                    "markdown": response.strip(),
                    "analysis_status": "completed"
                }
            else:
                return self._get_default_analysis_result("æœªçŸ¥åšä¸»")
            
        except Exception as e:
            print(f"âš ï¸ è§£æåˆ†æå“åº”å¤±è´¥: {e}")
            return self._get_default_analysis_result("æœªçŸ¥åšä¸»")
    
    def _get_default_analysis_result(self, blogger_name: str) -> Dict:
        """è·å–é»˜è®¤åˆ†æç»“æœ"""
        return {
            "markdown": f"""## åˆ†ææŠ¥å‘Šç”Ÿæˆå¤±è´¥

å¾ˆæŠ±æ­‰ï¼Œ{blogger_name}çš„åˆ†ææŠ¥å‘Šç”Ÿæˆè¿‡ç¨‹ä¸­é‡åˆ°äº†é—®é¢˜ã€‚

### å¯èƒ½çš„åŸå› 
- APIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨
- ç½‘ç»œè¿æ¥é—®é¢˜
- æ•°æ®æ ¼å¼å¼‚å¸¸

### å»ºè®®æ“ä½œ
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¨åé‡è¯•ç”ŸæˆæŠ¥å‘Š
3. å¦‚é—®é¢˜æŒç»­ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒ

---
*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}*""",
            "analysis_status": "failed"
        }


def analyze_blogger_with_deepseek(blogger_name: str, videos_data: List[Dict]) -> Dict:
    """ä½¿ç”¨DeepSeekåˆ†æåšä¸»çš„ä¾¿æ·å‡½æ•°"""
    analyzer = DeepSeekAnalyzer()
    return analyzer.analyze_blogger_style(blogger_name, videos_data)
